<!DOCTYPE html>
<html>
    <head>
        <title>kramer2.0_pilotA5_day2</title>
        <script src="jspsych/jspsych.js"></script>
        <script src="jspsych/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych/plugins/jspsych-survey-text.js"></script>
        <script src="jspsych/plugins/jspsych-image-keyboard-response.js"></script>
        <script src="jspsych/plugins/jspsych-video-keyboard-response.js"></script>
        <script src="jspsych/plugins/jspsych-html-button-response.js"></script>
        <script src="jspsych/plugins/jspsych-call-function.js"></script>
        <script src="jspsych/plugins/jspsych-survey-likert.js"></script>
        <script src="jspsych/plugins/jspsych-html-slider-response-fix.js"></script>
        <script src="jspsych/external/instructions.js"></script>
        <script src="jspsych/external/recall_stim_timed.js"></script>
        <script src="jspsych/external/timeline_stim_all.js"></script>
        <link href="jspsych/css/jspsych.css" rel="stylesheet" type="text/css">
    </head>
    <body></body>
    <script>

// kramer2.0_pilotB5 Day 2 (Retrieval Only)
// Angelique I. Delarazan 09/25/2021

// set subject ID and version number in the URL
var subject = jsPsych.data.getURLVariable('subject')
var version = jsPsych.data.getURLVariable('version')

// initiate correct story recall version
recall_stim_list = [
  recall_version1, 
  recall_version2, 
  recall_version3, 
  recall_version4, 
  recall_version5, 
  recall_version6, 
  recall_version7, 
  recall_version8, 
  recall_version9, 
  recall_version10, 
  recall_version11, 
  recall_version12, 
  recall_version13, 
  recall_version14,
  recall_version15, 
  recall_version16, 
  recall_version17, 
  recall_version18, 
  recall_version19, 
  recall_version20,
  recall_version21, 
  recall_version22, 
  recall_version23, 
  recall_version24, 
  recall_version25, 
  recall_version26,
  recall_version27, 
  recall_version28, 
  recall_version29, 
  recall_version30, 
  recall_version31, 
  recall_version32
]
var recall_stim = recall_stim_list[version-1] 

// initiate correct story version
timeline_stim_list = [
  timeline_version1, 
  timeline_version2, 
  timeline_version3, 
  timeline_version4, 
  timeline_version5, 
  timeline_version6, 
  timeline_version7, 
  timeline_version8, 
  timeline_version9, 
  timeline_version10, 
  timeline_version11, 
  timeline_version12, 
  timeline_version13, 
  timeline_version14,
  timeline_version15, 
  timeline_version16, 
  timeline_version17, 
  timeline_version18, 
  timeline_version19, 
  timeline_version20,
  timeline_version21, 
  timeline_version22, 
  timeline_version23, 
  timeline_version24, 
  timeline_version25, 
  timeline_version26,
  timeline_version27, 
  timeline_version28, 
  timeline_version29, 
  timeline_version30, 
  timeline_version31, 
  timeline_version32
]
var timeline_stim = timeline_stim_list[version-1] 

// experimenter notification
var notification = {
  type: "html-keyboard-response",
  stimulus: notification,
  choices: [' '],
  response_ends_trial: true
};

//  welcome message
var welcome = {
  type: "html-keyboard-response",
  stimulus: welcome_day2,
  choices: [' '],
  response_ends_trial: true
}; 

// recall
//   recall_instructions
var recall_instructions = {
  type: "html-keyboard-response",
  stimulus: recall_instructions,
  choices: [' ']
};

  // sideplots
var recall_sideplots = {
  timeline: [{
    type: 'survey-text',
    preamble: jsPsych.timelineVariable('recall_stim'),
    questions: jsPsych.timelineVariable('prompt'),
    data: {'character':jsPsych.timelineVariable('character'), 'event_1':jsPsych.timelineVariable('event_1'), 'event_2':jsPsych.timelineVariable('event_2'), 'coherence': jsPsych.timelineVariable('coherence'),'lag':jsPsych.timelineVariable('lag'), 'plot': jsPsych.timelineVariable('plot')}}],
    timeline_variables: recall_stim,
    button_label:'Continue',
  on_load: function(){
    var wait_time = 1 * 6 * 30000; // in milliseconds
    var start_time = performance.now();
    document.querySelector('#jspsych-survey-text-next').disabled = true;
    var interval = setInterval(function(){
      var time_left = wait_time - (performance.now() - start_time);
      var minutes = Math.floor(time_left / 1000 / 60);
      var seconds = Math.floor((time_left - minutes*1000*60)/1000);
      var seconds_str = seconds.toString().padStart(2,'0');
      document.querySelector('#clock').innerHTML = minutes + ':' + seconds_str
      if(time_left <= 0){
        document.querySelector('#clock').innerHTML = "0:00";
        document.querySelector('#jspsych-survey-text-next').disabled = false;
        clearInterval(interval);
      }
    }, 250)
  },
  randomize_order: true,
  trial_duration: 5000  
};

var recall_mainplot = {
  type: 'survey-text',
  questions: [
    {prompt: recall_mainplot_instructions, rows: 20, columns: 100}, 
  ],
  data: {'character':'Charles', 'coherence': 'mainplot','lag':'mainplot', 'plot': 'mainplot'},
  // preamble:,
  button_label:'Continue',
  
  on_load: function(){
    var wait_time = 1 * 6 * 60000; // in milliseconds
    var start_time = performance.now();
    document.querySelector('#jspsych-survey-text-next').disabled = true;
    var interval = setInterval(function(){
      var time_left = wait_time - (performance.now() - start_time);
      var minutes = Math.floor(time_left / 1000 / 60);
      var seconds = Math.floor((time_left - minutes*1000*60)/1000);
      var seconds_str = seconds.toString().padStart(2,'0');
      document.querySelector('#clock').innerHTML = minutes + ':' + seconds_str
      if(time_left <= 0){
        document.querySelector('#clock').innerHTML = "0:00";
        document.querySelector('#jspsych-survey-text-next').disabled = false;
        clearInterval(interval);
      }
    }, 250)
  }
}; 

// timeline
  // timeline_test_instructions
var timeline_test_instructions0 = {
  type: "html-keyboard-response",
  stimulus: timeline_test_instructions0,
  choices: [' ']
}; 

var timeline_test_instructions1 = {
  type: "html-keyboard-response",
  stimulus: timeline_test_instructions1,
  choices: [' ']
}; 

  // timeline_test
  var timeline_test = {
timeline: [
  {
    type: 'html-slider-response-fix',
    stimulus: jsPsych.timelineVariable('stimulus'),
    labels: ['1<br>Start', '144<br>End'],
    min: 1, 
    max: 144,
    prompt: timeline_test_instructions,
    slider_start: 72, 
    require_movement: true,
    slider_width: 800,
    data: {'character':jsPsych.timelineVariable('character'), 'act': jsPsych.timelineVariable('act'), 'scene':jsPsych.timelineVariable('scene'), 'event':jsPsych.timelineVariable('event'), 'postition':jsPsych.timelineVariable('position'),
    'coherence': jsPsych.timelineVariable('coherence'),'lag':jsPsych.timelineVariable('lag'), 'plot': jsPsych.timelineVariable('plot')}
  }
  ], 
  timeline_variables: timeline_stim,
  randomize_order: true,
  trial_duration: 10000
};

// post_experiment_questions
var difficulty_scale = [
  "Very Easy", 
  "Easy", 
  "Neutral", 
  "Difficult", 
  "Very Difficult"
];

var agreeability_scale = [
  "Strongly Disagree", 
  "Disagree", 
  "Neutral", 
  "Agree", 
  "Strongly Agree"
];

var post_experiment_questions1 = {
  type: 'survey-likert',
  questions: [
    // {prompt: "Rate the difficulty of the task that asked you to recall everything that you can remember about the characters (character recall task).", name: 'recall_difficulty', labels: difficulty_scale},
    {prompt: "Rate the difficulty of the task that asked you to estimate the distance between the two images (event distance task).", name: 'timeline_task_difficulty', labels: difficulty_scale},
    {prompt: "The instructions were very clear.", name: 'instructions_rating', labels: agreeability_scale},
    {prompt: "I felt engaged in throughout the experiment.", name: 'engagement_rating', labels: agreeability_scale}
  ],
  randomize_question_order: true
};


var post_experiment_questions2 = {
  type: 'survey-text',
  questions: [
    // {prompt: "Post-Experiment Questionnaire<p><br></p> For the character recall task, what specific strategies did you use? Please explain.", rows: 6, columns: 120}, 
    {prompt: "For the event distance task, what specific strategies did you use? Please explain.", rows: 6, columns: 120},
    {prompt: "What did you notice about the order of characters? Please explain.", rows: 6, columns: 120},
    {prompt: "Which character(s) did you find MOST interesting? Why? Please explain", rows: 6, columns: 120},
    {prompt: "Which character(s) did you find LEAST interesting? Why? Please explain.", rows: 6, columns: 120},
    {prompt: "Additional comments or suggestions.", rows: 6, columns: 120},
  ],
};

// debriefing
var debriefing = {
  type: "html-keyboard-response",
  stimulus: debriefing,
  choices: [' '],
  response_ends_trial: true
}; 

// experiment end
var end = {
  type: "html-keyboard-response",
  stimulus: end_day2,
  choices: [' '],
  response_ends_trial: true
};

jsPsych.init({
  data: {subject:subject, version:version},
  timeline: [
    welcome,
    recall_instructions,
    recall_sideplots,
    recall_mainplot,
    notification,
    timeline_test_instructions0, 
    timeline_test_instructions1,
    timeline_test,
    post_experiment_questions1,
    post_experiment_questions2,
    debriefing,
    end
  ],
  on_finish: function () {
      jsPsych.data.addProperties({subject: subject, version: version});
      var file_name = 'sub-' + subject + '_version-' + version + '_day-2_kramer2.0_pilotA5.csv';
      jsPsych.data.get().localSave('csv',file_name);
  }
}
);

    </script>
</html>